<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–∞—Ä–∞–≤–∞–Ω—É</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c1810 0%, #8b4513 50%, #cd853f 100%);
            min-height: 100vh;
            padding: 20px;
            color: #f4f4f4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #cd853f;
        }

        h1 {
            text-align: center;
            color: #ffd700;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #cd853f;
            font-size: 1.2rem;
            margin-bottom: 30px;
            font-style: italic;
            opacity: 0.9;
        }

        .main-button {
            display: block;
            width: 300px;
            margin: 0 auto 30px;
            padding: 15px 30px;
            background: linear-gradient(45deg, #8b4513, #cd853f);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .main-button:hover {
            background: linear-gradient(45deg, #cd853f, #ffd700);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .caravan-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(139, 69, 19, 0.3);
            border: 1px solid #cd853f;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .stat-title {
            color: #ffd700;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 2px solid #cd853f;
            padding-bottom: 5px;
        }

        .stat-value {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .story-section {
            margin-top: 30px;
        }

        .story-item {
            background: rgba(205, 133, 63, 0.2);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            position: relative;
        }

        .story-question {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .story-answer {
            font-size: 1rem;
            line-height: 1.5;
        }

        .reroll-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #8b4513;
            color: white;
            border: none;
            border-radius: 20px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reroll-btn:hover {
            background: #cd853f;
            transform: rotate(180deg);
        }

        .improvements-section {
            margin-top: 30px;
            background: rgba(139, 69, 19, 0.2);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #cd853f;
            position: relative;
        }

        .improvement-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #ffd700;
        }

        .improvement-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .improvement-desc {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .karma-reputation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .karma-item, .reputation-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #cd853f;
            position: relative;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .karma-reputation {
                grid-template-columns: 1fr;
            }
            
            .caravan-stats {
                grid-template-columns: 1fr;
            }
        }
    
        /* --- Text export area (added) --- */
        .export-section {
            margin-top: 30px;
            padding: 20px 30px 30px;
            background: rgba(0,0,0,0.6);
            border-radius: 12px;
            border: 1px solid #cd853f;
        }
        .export-section h2 {
            color: #ffd700;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #cd853f;
        }
        .text-output {
            width: 100%;
            min-height: 220px;
            resize: vertical;
            padding: 12px;
            background: rgba(0,0,0,0.35);
            color: #f4f4f4;
            border-radius: 10px;
            border: 1px solid #cd853f;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.95em;
            line-height: 1.35;
        }
        .copy-row {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 10px;
        }
        .copy-hint {
            font-size: 0.9em;
            color: #ffd700;
            opacity: 0.85;
        }
        .copy-btn {
            background: linear-gradient(45deg, #8b4513, #cd853f);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.25);
            font-weight: 600;
            letter-spacing: .3px;
        }
        .copy-btn:hover {
            background: linear-gradient(45deg, #cd853f, #ffd700);
            transform: translateY(-1px);
        }
        @media print {
            .copy-row { display: none; }
            .text-output { min-height: 0; }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–∞—Ä–∞–≤–∞–Ω—É</h1>
        <div class="subtitle">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–∞—Ä–∞–≤–∞–Ω—É –¥–ª—è –Ω–∞—Å—Ç—ñ–ª—å–Ω–æ—ó —Ä–æ–ª—å–æ–≤–æ—ó –≥—Ä–∏ "–ü—É—Å—Ç–µ–ª—å–Ω–∏–∫–∏"</div>
        
        <button class="main-button" onclick="generateCaravan()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ù–æ–≤–∏–π –ö–∞—Ä–∞–≤–∞–Ω</button>
        
        <div id="caravan-content" style="display: none;">
            <div class="caravan-stats">
                <div class="stat-card">
                    <div class="stat-title">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ö–∞—Ä–∞–≤–∞–Ω—É</div>
                    <div class="stat-value">–ú–∞–∫—Å. –û–ó: <span id="max-hp"></span></div>
                    <div class="stat-value">–ë—Ä–æ–Ω—è: <span id="armor"></span></div>
                    <div class="stat-value">–ó–∞–ø–∞—Å —Ö–æ–¥—É: <span id="movement"></span></div>
                    <div class="stat-value">–ë—é–¥–∂–µ—Ç –∫—Ä–∏—à–æ–∫: <span id="budget"></span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">–ù–∞–∑–≤–∞ –ö–æ–º–ø–∞–Ω—ñ—ó</div>
                    <div class="stat-value" id="company-name-display"></div>
                    <button class="reroll-btn" onclick="rerollCompanyName()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É">üé≤</button>
                </div>
            </div>

            <div class="improvements-section">
                <div class="stat-title">–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ö–∞—Ä–∞–≤–∞–Ω—É</div>
                <button class="reroll-btn" onclick="rerollImprovements()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è">üé≤</button>
                <div id="improvements-list"></div>
            </div>

            <div class="story-section">
                <div class="story-item">
                    <button class="reroll-btn" onclick="rerollMeeting()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏">üé≤</button>
                    <div class="story-question">–Ø–∫ –≤–∏ –ø–æ–∑–Ω–∞–π–æ–º–∏–ª–∏—Å—å?</div>
                    <div class="story-answer" id="meeting-answer"></div>
                </div>

                <div class="story-item">
                    <button class="reroll-btn" onclick="rerollLastJob()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏">üé≤</button>
                    <div class="story-question">–Ø–∫—É –æ—Å—Ç–∞–Ω–Ω—é —Å–ø—Ä–∞–≤—É –≤–∏ –ø—Ä–æ–≤–µ—Ä–Ω—É–ª–∏ —Ä–∞–∑–æ–º?</div>
                    <div class="story-answer" id="last-job-answer"></div>
                </div>

                <div class="story-item">
                    <button class="reroll-btn" onclick="rerollWentWrong()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏">üé≤</button>
                    <div class="story-question">–©–æ –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫ –≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å–ø—Ä–∞–≤—ñ?</div>
                    <div class="story-answer" id="went-wrong-answer"></div>
                </div>
            </div>

            <div class="karma-reputation">
                <div class="karma-item">
                    <div class="stat-title">–ö–∞—Ä–º–∞</div>
                    <button class="reroll-btn" onclick="rerollKarma()" title="–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ä–º—É">üé≤</button>
                    <div class="stat-value" id="karma-value"></div>
                    <div class="stat-value" id="karma-aspect"></div>
                </div>
                
                <div class="reputation-item">
                    <div class="stat-title">–†–µ–ø—É—Ç–∞—Ü—ñ—è</div>
                    <div class="stat-value">–Ω—ñ—Ö—Ç–æ –π –∑–≤–∞—Ç–∏ –Ω—ñ—è–∫</div>
                </div>
            </div>
        </div>
    </div>
        <div class="export-section">
            <h2>üßæ –¢–µ–∫—Å—Ç–æ–≤–∏–π –≤–∏–≤—ñ–¥</h2>
            <textarea id="textOutput" class="text-output" readonly placeholder="–ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –∫–∞—Ä–∞–≤–∞–Ω, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Ç—É—Ç —Ç–µ–∫—Å—Ç–æ–≤–∏–π –≤–∏–≤—ñ–¥‚Ä¶"></textarea>
            <div class="copy-row">
                <span class="copy-hint">–°–∫–æ–ø—ñ—é—î —É—Å–µ —è–∫ –ø—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç.</span>
                <button type="button" class="copy-btn" id="copyBtn">üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
            </div>
        </div>


    <script>
        const improvements = [
            { name: "–î–æ–¥–∞—Ç–∫–æ–≤–∞ –±—Ä–æ–Ω—è", desc: "–¥–∞—î –∫–∞—Ä–∞–≤–∞–Ω—É +2 –±—Ä–æ–Ω—ñ." },
            { name: "–ü–æ—Å–∏–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è", desc: "–¥–∞—î –∫–∞—Ä–∞–≤–∞–Ω—É +10 –û–ó. –¶–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –±—Ä–∞—Ç–∏ –¥–æ —Ç—Ä—å–æ—Ö —Ä–∞–∑—ñ–≤." },
            { name: "–î–æ–¥–∞—Ç–∫–æ–≤–µ –º—ñ—Å—Ü–µ –¥–ª—è –∫–æ—Ä–º—É (–ø–∞–ª–∏–≤–∞)", desc: "–∑–±—ñ–ª—å—à—É—î –∑–∞–ø–∞—Å —Ö–æ–¥—É –Ω–∞ 5 –∫–ª—ñ—Ç–∏–Ω. –ú–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –¥–æ –¥–≤–æ—Ö —Ä–∞–∑—ñ–≤." },
            { name: "–¢—É—Ä–µ–ª—å", desc: "—É –≤–∞—à–æ–≥–æ –∫–∞—Ä–∞–≤–∞–Ω—É —î —Å—Ç–∞—Ü—ñ–æ–Ω–∞—Ä–Ω–∞ —Ç—É—Ä–µ–ª—å. –í–æ–Ω–∞ –≤–≤–∞–∂–∞—î—Ç—å—Å—è –≤–∞–∂–∫–æ—é –∑–±—Ä–æ—î—é (2d6 —à–∫–æ–¥–∏ –≤ –±–æ—é –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ), –∞–ª–µ —ó—ó –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂, –Ω–∞–≤—ñ—Ç—å —Ç–æ–π, —Ö—Ç–æ –π –ø—ñ–¥–Ω—è—Ç–∏ —Ü—é –≥–∞—Ä–º–∞—Ç—É –Ω–µ –º—ñ–≥ –±–∏." },
            { name: "–ê–º–±—Ä–∞–∑—É—Ä–∏", desc: "–≤–∞—à –∫–∞—Ä–∞–≤–∞–Ω –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫ —É–∫—Ä–∏—Ç—Ç—è —É –±–æ—é. –Ø–∫—â–æ –≤–∏ —Ö–æ–≤–∞—î—Ç–µ—Å—è –∑–∞ –∞–º–±—Ä–∞–∑—É—Ä–∞–º–∏, –∫–æ–ª–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ —à–∫–æ–¥—É, –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏, —Ö—Ç–æ –æ—Ç—Ä–∏–º–∞—î —à–∫–æ–¥—É --- –≤–∏ —á–∏ –∫–∞—Ä–∞–≤–∞–Ω." },
            { name: "–°–ø–æ—Å—Ç–µ—Ä–µ–∂–Ω–µ –≥–Ω—ñ–∑–¥–æ", desc: "–ø—Ä–∏ –ø–æ–¥–æ—Ä–æ–∂–∞—Ö —Ç–æ–π, —Ö—Ç–æ —Ä–æ–±–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø–æ–¥–æ—Ä–æ–∂—ñ, –æ—Ç—Ä–∏–º—É—î +1, —è–∫—â–æ –≤—ñ–Ω –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É –≥–Ω—ñ–∑–¥—ñ." },
            { name: "–ü–æ—Ä–æ–¥–∏—Å—Ç—ñ –±—Ä–∞–º—ñ–Ω–∏ (–∞–±–æ –ø–∞–ª–∏–≤–Ω–∏–π —Ä–µ–≥—É–ª—è—Ç–æ—Ä, —è–∫—â–æ —É –≤–∞—Å —Ç–∞—á–∫–∞)", desc: "–ø–µ—Ä–µ–¥ –ø–æ–¥–æ—Ä–æ–∂–∂—é –æ–±–µ—Ä—ñ—Ç—å –æ–¥–Ω–µ –∑ –¥–≤–æ—Ö: —à–ª—è—Ö –∑–∞–π–º–∞—î –Ω–∞ —á–≤–µ—Ä—Ç—å –º–µ–Ω—à–µ —á–∞—Å—É –∞–±–æ –∫–∞—Ä–∞–≤–∞–Ω –≤–∏—Ç—Ä–∞—á–∞—î –Ω–∞ —á–≤–µ—Ä—Ç—å –º–µ–Ω—à–µ –∑–∞–ø–∞—Å—É —Ö–æ–¥—É (–æ–∫—Ä—É–≥–ª—é—é—á–∏ –≤–≥–æ—Ä—É). –Ø–∫—â–æ —É –∫–æ–≥–æ—Å—å —ñ–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ —î –ø–µ—Ä–∫ ¬´–ü–µ—Ä—à–æ–ø—Ä–æ—Ö–æ–¥–µ—Ü—å¬ª --- —Ü–µ–π –±–æ–Ω—É—Å –∑—Ä–æ—Å—Ç–∞—î –¥–æ –ø–æ–ª–æ–≤–∏–Ω–∏ —á–∞—Å—É –∞–±–æ –ø–æ–ª–æ–≤–∏–Ω–∏ –∑–∞–ø–∞—Å—É —Ö–æ–¥—É (–æ–∫—Ä—É–≥–ª—é—é—á–∏ –≤–≥–æ—Ä—É)." },
            { name: "–°–∫—Ä–∏–Ω—å–∫–∞ –∑ –ü—Ä–∏–ø–∞—Å–∞–º–∏", desc: "–¥–∞—î –≤–∞—à–æ–º—É –∫–∞—Ä–∞–≤–∞–Ω—É –º—ñ—Å—Ü–µ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è 3 –æ–¥–∏–Ω–∏—Ü—å –ü—Ä–∏–ø–∞—Å—ñ–≤. –ú–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –¥–æ –¥–≤–æ—Ö —Ä–∞–∑—ñ–≤." },
            { name: "–ó–±—ñ–ª—å—à–µ–Ω–∏–π –±–∞–≥–∞–∂–Ω–∏–∫", desc: "–¥–æ–∑–≤–æ–ª—è—î –≤–∑—è—Ç–∏ –≤–¥–≤—ñ—á—ñ –±—ñ–ª—å—à–µ –∫–æ—Ä–∏—Å–Ω–æ–≥–æ –≤–∞–Ω—Ç–∞–∂—É –∞–±–æ –≤–∞–Ω—Ç–∞–∂ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö —Ä–æ–∑–º—ñ—Ä—ñ–≤ (–¥–æ 3 –∫—É–±—ñ—á–Ω–∏—Ö –º–µ—Ç—Ä—ñ–≤). –¶–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –¥–æ –¥–≤–æ—Ö —Ä–∞–∑—ñ–≤. –î—Ä—É–≥–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–±—ñ–ª—å—à–∏—Ç—å –∫–æ—Ä–∏—Å–Ω–∏–π –æ–±'—î–º –¥–æ 6 –∫—É–±—ñ—á–Ω–∏—Ö –º–µ—Ç—Ä—ñ–≤." },
            { name: "–ü–æ–ª—ñ–ø—à–µ–Ω–∞ –∫–∞–±—ñ–Ω–∞ –¥–ª—è –ø–∞—Å–∞–∂–∏—Ä—ñ–≤", desc: "—É–∫—Ä—ñ–ø–ª–µ–Ω–∞ –∫–∞–±—ñ–Ω–∞ –∑ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∏–º —Å–ø–∞–ª—å–Ω–∏–º –º—ñ—Å—Ü–µ–º –¥–ª—è –¥–≤–æ—Ö –ª—é–¥–µ–π. –ß–∏–º–∞–ª–æ –∑–∞–º–æ–∂–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ –Ω–µ –ø–æ–≥–æ–¥—è—Ç—å—Å—è –ø–æ–¥–æ—Ä–æ–∂—É–≤–∞—Ç–∏ –∑ –≤–∞–º–∏, —è–∫—â–æ —É –≤–∞—Å —Ç–∞–∫–æ—ó –Ω–µ–º–∞—î. –ó–∞–±–µ–∑–ø–µ—á—É—î –ø–∞—Å–∞–∂–∏—Ä–∞–º –ø–æ–≤–Ω—É –±–µ–∑–ø–µ–∫—É, –∫—Ä—ñ–º –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ –∫–∞—Ä–∞–≤–∞–Ω –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–Ω–∏—â—É—é—Ç—å –≤–æ–≥–Ω–µ–º." },
            { name: "–°–≤–∏–Ω—Ü–µ–≤–∞ –æ–±—à–∏–≤–∫–∞", desc: "–¥–æ–∑–≤–æ–ª—è—î –≤–∞—à–æ–º—É –∫–∞—Ä–∞–≤–∞–Ω—É –ø–æ–¥–æ—Ä–æ–∂—É–≤–∞—Ç–∏ —Ä–∞–¥—ñ–æ–∞–∫—Ç–∏–≤–Ω–∏–º–∏ –º—ñ—Å—Ü–∏–Ω–∞–º–∏, –∑ –ø–æ–ª–æ–≤–∏–Ω–Ω–æ—é —à–∫–æ–¥–æ—é (–æ–∫—Ä—É–≥–ª—é—é—á–∏ –≤–≥–æ—Ä—É) –¥–ª—è –≤—Å—ñ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤. –ë–µ–∑ —Ü—å–æ–≥–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –±–∞–≥–∞—Ç–æ –ø–∞—Å–∞–∂–∏—Ä—ñ–≤ –≤—ñ–¥–º–æ–≤–ª—è—Ç—å—Å—è –ø–æ–¥–æ—Ä–æ–∂—É–≤–∞—Ç–∏ –∑ –≤–∞—à–∏–º –∫–∞—Ä–∞–≤–∞–Ω–æ–º, —è–∫—â–æ –º–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏–º–µ –∑–∞—Ä–∞–∂–µ–Ω–∏–º–∏ –º—ñ—Å—Ü—è–º–∏." },
            { name: "–õ—ñ–∂–∫–æ –¥–ª—è —Ö–≤–æ—Ä–æ–≥–æ", desc: "–æ–∫—Ä–µ–º–µ –ª—ñ–∂–∫–æ –∑ –º–µ–¥–∏—á–Ω–∏–º –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è–º, —è–∫–µ —Å–∏–ª—å–Ω–æ –ø–æ–∫—Ä–∞—â—É—î —à–∞–Ω—Å–∏ –Ω–∞ –≤–∏–∂–∏–≤–∞–Ω–Ω—è –¥–ª—è —Ç–æ–≥–æ, –∫–æ–º—É –Ω–µ –ø–æ—â–∞—Å—Ç–∏–ª–æ. –í–º—ñ—â—É—î –æ–¥–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –ü–µ—Ä—Å–æ–Ω–∞–∂, —è–∫–∏–π –≤—ñ–¥–ø–æ—á–∏–≤–∞—î –Ω–∞ –ª—ñ–∂–∫—É –¥–ª—è —Ö–≤–æ—Ä–æ–≥–æ, –∑–∞ –≤–∏—Ç—Ä–∞—Ç—É –æ–¥–∏–Ω–∏—Ü—ñ –ü—Ä–∏–ø–∞—Å—ñ–≤ –≤—ñ–¥–Ω–æ–≤–ª—é—î –≤—Å—ñ –û–ó –∑–∞–º—ñ—Å—Ç—å –ø–æ–ª–æ–≤–∏–Ω–∏. –¢–∞–∫–æ–∂ —è–∫—â–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ª—ñ–∫—É—é—Ç—å –Ω–∞ –ª—ñ–∂–∫—É –¥–ª—è —Ö–≤–æ—Ä–∏—Ö, –º–µ–¥–∏–∫ –æ—Ç—Ä–∏–º—É—î +1 –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏." }
        ];

        const meetingOptions = [
            "–ü—ñ—Å–ª—è –±—É—Ä—Ö–ª–∏–≤–æ—ó –ø–∏—è—Ç–∏–∫–∏ –≤ –±–∞—Ä—ñ, —â–æ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—è –≥—Ä–∞–Ω–¥—ñ–æ–∑–Ω–æ—é –±—ñ–π–∫–æ—é —Ç–∞ –Ω–∞–±—É—Ç—Ç—è–º –∫—Ä–µ–≤–Ω–æ—ó –≤–æ—Ä–æ–∂–Ω–µ—á—ñ (–∑ –∫–∏–º?)",
            "–í–ª–∞—Å–Ω–∏–∫ –∫–∞—Ä–∞–≤–∞–Ω—É (–æ–¥–∏–Ω –∑ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ –≥—Ä–∞–≤—Ü—ñ–≤) –ø—ñ–¥—ñ–±—Ä–∞–≤ –Ω–∞—Å —É –ü—É—Å—Ç—Ü—ñ. –Ü–Ω–∞–∫—à–µ –º–∏ –± –ø–æ–º–µ—Ä–ª–∏.",
            "–ú–∏ –Ω–∞–ø–∞–ª–∏ –Ω–∞ —Ç–∏—Ö, –Ω–∞ –∫–æ–≥–æ –Ω–µ —Å–ª—ñ–¥ (–Ω–∞ –∫–æ–≥–æ?)",
            "–†–∞–∑–æ–º –º–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ –≤—Å–µ –¥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∫–æ–ø—ñ–π—á–∏–Ω–∏ —ñ —Ç–µ–ø–µ—Ä –ø–æ–≤–∏–Ω–Ω—ñ –≤—ñ–¥–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–æ—Ä–≥ (—è–∫–∏–π?)",
            "–£ –Ω–∞—Å —É—Å—ñ—Ö —î —Å–ø—ñ–ª—å–Ω–∏–π –¥—Ä—É–≥ (—Ö—Ç–æ?)",
            "–ù–∞—Å —Ä–∞–∑–æ–º –Ω–∞–π–Ω—è–ª–∏ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Å–ø—Ä–∞–≤—É (—è–∫—É?). –ü—ñ—Å–ª—è –Ω–µ—ó –º–∏ –≤–∏—Ä—ñ—à–∏–ª–∏ —Å—Ç–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–æ—é.",
            "–ú–∏ –≤—Å—ñ –≤—Ç–µ–∫–ª–∏ –∑ –æ–¥–Ω–æ–≥–æ —ñ —Ç–æ–≥–æ –∂ —Ä–∞–±–æ–≤–ª–∞—Å–Ω–∏—Ü—å–∫–æ–≥–æ —Ç–∞–±–æ—Ä—É –≤ –æ–¥–∏–Ω –¥–µ–Ω—å —ñ –¥–æ–ø–æ–º–æ–≥–ª–∏ –æ–¥–∏–Ω –æ–¥–Ω–æ–º—É –≤–∏–∂–∏—Ç–∏.",
            "–ü—ñ–¥ —á–∞—Å —Ç–æ—Ä–≥–æ–≤–æ—ó —É–≥–æ–¥–∏ –Ω–∞—Å –æ–±–º–∞–Ω—É–ª–∏ –æ–¥–Ω—ñ —ñ —Ç—ñ –∂ —à–∞—Ö—Ä–∞—ó, —Ç–æ–º—É –º–∏ –æ–±'—î–¥–Ω–∞–ª–∏—Å—è, —â–æ–± –ø–æ–º—Å—Ç–∏—Ç–∏—Å—è.",
            "–ú–∏ –∑—É—Å—Ç—Ä—ñ–ª–∏—Å—è –ø—ñ–¥ —á–∞—Å –º–∞—Ä–æ–¥–µ—Ä—Å—Ç–≤–∞ –Ω–∞ —Ä—É—ó–Ω–∞—Ö –¥–æ–≤–æ—î–Ω–Ω–æ–≥–æ –º—ñ—Å—Ç–∞ (—è–∫–æ–≥–æ?) —ñ –≤–∏—Ä—ñ—à–∏–ª–∏ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ä–∞–∑–æ–º.",
            "–†–∞–¥—ñ–∞—Ü—ñ–π–Ω–∞ –±—É—Ä—è –∑–∞—Å—Ç–∞–ª–∞ –Ω–∞—Å —É—Å—ñ—Ö —É —Ç–æ–º—É –∂ —É–∫—Ä–∏—Ç—Ç—ñ, –¥–µ –º–∏ –ø—Ä–æ–≤–µ–ª–∏ —Ç—Ä–∏ –¥–Ω—ñ, –¥—ñ–ª—è—á–∏—Å—å –ø—Ä–∏–ø–∞—Å–∞–º–∏ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—è–º–∏."
        ];

        const lastJobOptions = [
            "–ú–∏ –¥–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π –≤–∞–Ω—Ç–∞–∂ (—è–∫–∏–π?) —É —Ä–µ–∫–æ—Ä–¥–Ω–∏–π —Å—Ç—Ä–æ–∫.",
            "–ú–∏ –ø–æ–≥—Ä–∞–±—É–≤–∞–ª–∏ –≤–ø–ª–∏–≤–æ–≤—É —à–∏—à–∫—É –æ–¥–Ω—ñ—î—ó –∑ —Ñ—Ä–∞–∫—Ü—ñ–π (–∫–æ–≥–æ?).",
            "–ú–∏ –≤–ª–∞—à—Ç—É–≤–∞–ª–∏ –ø–æ–ª—é–≤–∞–Ω–Ω—è –Ω–∞ –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ–≥–æ –º—É—Ç–∞–Ω—Ç–∞ (—è–∫–æ–≥–æ?).",
            "–ú–∏ –ø—Ä–æ–Ω–∏–∫–ª–∏ –Ω–∞ –ø–æ–∫–∏–Ω—É—Ç–∏–π –¥–æ–≤–æ—î–Ω–Ω–∏–π –æ–±'—î–∫—Ç (—è–∫–∏–π?).",
            "–ú–∏ –≤–∑—è–ª–∏—Å—è –∑–∞ –ø–µ—Ä–µ–≤–µ–∑–µ–Ω–Ω—è –≤–∞–∂–ª–∏–≤–æ—ó –æ—Å–æ–±–∏ (–∫–æ–≥–æ?).",
            "–ù–∞–º –∑–∞–º–æ–≤–∏–ª–∏ –∑–Ω–∞–π—Ç–∏ —ñ –¥–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ–¥–Ω—É —Ä—ñ–¥–∫—ñ—Å–Ω—É —Ä—ñ—á (—è–∫—É?).",
            "–ú–∏ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–ª–∏ –µ—Å–∫–æ—Ä—Ç —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –∫–∞—Ä–∞–≤–∞–Ω—É —á–µ—Ä–µ–∑ –Ω–µ–±–µ–∑–ø–µ—á–Ω—É —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—é —Ä–µ–π–¥–µ—Ä—ñ–≤.",
            "–ù–∞—Å –Ω–∞–π–Ω—è–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–æ–¥—è–Ω—É —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω—É –≤—ñ–¥ –º—É—Ç–∞–Ω—Ç—ñ–≤, —â–æ –≤ –Ω—ñ–π –æ—Å–µ–ª–∏–ª–∏—Å—è.",
            "–ú–∏ –¥–æ–ø–æ–º–æ–≥–ª–∏ –µ–≤–∞–∫—É—é–≤–∞—Ç–∏ –º–∏—Ä–Ω–∏—Ö –∂–∏—Ç–µ–ª—ñ–≤ –∑ –º—ñ—Å—Ç–∞ –ø—ñ–¥ —á–∞—Å —à—Ç—É—Ä–º—É —Å—É–ø–µ—Ä–º—É—Ç–∞–Ω—Ç—ñ–≤.",
            "–ù–∞–º –¥–æ—Ä—É—á–∏–ª–∏ –∑–Ω–∞–π—Ç–∏ —Ç–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –≤–∏–∫—Ä–∞–¥–µ–Ω—É —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—é –ë—Ä–∞—Ç—Å—Ç–≤–∞ –°—Ç–∞–ª—ñ."
        ];

        const wentWrongOptions = [
            "–ù–∞–º –Ω–µ –∑–∞–ø–ª–∞—Ç–∏–ª–∏, –∑–∞–º–æ–≤–Ω–∏–∫ –∑–º–∏–≤—Å—è. –í—ñ–Ω –≤—Å–µ —â–µ –≤–∏–Ω–µ–Ω –Ω–∞–º –≥—Ä–æ—à–µ–π.",
            "–ü—Ä–æ—Å—Ç–∞ —Å–ø—Ä–∞–≤–∞ –æ–±–µ—Ä–Ω—É–ª–∞—Å—è –±–∏—Ç–≤–æ—é, –∑ —è–∫–æ—ó –º–∏ –ª–µ–¥–≤–µ –≤—Ä—è—Ç—É–≤–∞–ª–∏—Å—å.",
            "–ó–∞–º–æ–≤–Ω–∏–∫ –Ω–∞–º–∞–≥–∞–≤—Å—è –Ω–∞—Å –ø—ñ–¥—Å—Ç–∞–≤–∏—Ç–∏.",
            "–ú–∏ –≤–∫—Ä–∞–ª–∏ —â–æ—Å—å –≤–∞–∂–ª–∏–≤–µ —ñ —Ç–µ–ø–µ—Ä –Ω–∞ –Ω–∞—Å –ø–æ–ª—é—é—Ç—å.",
            "–ú–∏ –¥—ñ–∑–Ω–∞–ª–∏—Å—å —â–æ—Å—å, —á–æ–≥–æ –Ω–∞–º –Ω–µ —Å–ª—ñ–¥ –±—É–ª–æ –∑–Ω–∞—Ç–∏.",
            "–ú–∏ –Ω–∞—Ç—Ä–∞–ø–∏–ª–∏ –Ω–∞ –Ω–∞–π–º–∞–Ω—Ü—ñ–≤, —è–∫–∏–º –∑–∞–ø–ª–∞—Ç–∏–ª–∏, —â–æ–± –Ω–∞—Å –∑–¥–∏—Ö–∞—Ç–∏—Å—è.",
            "–û–¥–∏–Ω –∑ —á–ª–µ–Ω—ñ–≤ –∫–æ–º–∞–Ω–¥–∏ –±—É–≤ —Ç–∞—î–º–Ω–∏–º –∞–≥–µ–Ω—Ç–æ–º –≤–æ—Ä–æ–∂–æ—ó —Ñ—Ä–∞–∫—Ü—ñ—ó —ñ –º–∞–π–∂–µ –∑—ñ—Ä–≤–∞–≤ –æ–ø–µ—Ä–∞—Ü—ñ—é.",
            "–†–∞–¥—ñ–∞—Ü—ñ–π–Ω–∞ –±—É—Ä—è –∑–∞—Å—Ç–∞–ª–∞ –Ω–∞—Å —É –Ω–∞–π–≥—ñ—Ä—à–∏–π –º–æ–º–µ–Ω—Ç, —ñ –º–∏ –≤—Ç—Ä–∞—Ç–∏–ª–∏ –ø–æ–ª–æ–≤–∏–Ω—É –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è.",
            "–í–∏—è–≤–∏–ª–æ—Å—è, —â–æ –≤–∞–Ω—Ç–∞–∂ –±—É–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏–π —Å–º–µ—Ä—Ç–µ–ª—å–Ω–∏–º –≤—ñ—Ä—É—Å–æ–º, —ñ —Ç–µ–ø–µ—Ä –Ω–∞—Å —à—É–∫–∞—î –ê–Ω–∫–ª–∞–≤.",
            "–ú–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ –ø—Ä–∏–≤–µ–ª–∏ –∑–∞ —Å–æ–±–æ—é –∑–≥—Ä–∞—é –¥–∏–∫—É–Ω—ñ–≤, —è–∫—ñ —Ä–æ–∑–æ—Ä–∏–ª–∏ –ø–æ—Å–µ–ª–µ–Ω–Ω—è –Ω–∞—à–∏—Ö –∑–∞–º–æ–≤–Ω–∏–∫—ñ–≤."
        ];

        const companyNames = [
            "–ë–∞–±–∞-–ó-–í–æ–∑—É", "–°—Ç–∞—Ä–∞ –ü–æ—à—Ç–∞", "–°–º–µ—Ä—Ç—å –Ω–∞ –ö–æ–ª–µ—Å–∞—Ö", "–î–∂–∞–≥–µ—Ä–Ω–∞—É—Ç", "–ü'—è—Ç–µ –ö–æ–ª–µ—Å–æ", "–ì–æ–ª–≤–æ",
            "–ó–∞–ª—ñ–∑–Ω–∏–π –í–µ—Ä–±–ª—é–¥", "–ü—É—Å—Ç–µ–ª—å–Ω—ñ –í–æ–≤–∫–∏", "–ö—Ä–æ–≤ —Ç–∞ –Ü—Ä–∂–∞", "–û—Å—Ç–∞–Ω–Ω—ñ–π –®–∞–Ω—Å", "–Ø–¥–µ—Ä–Ω–∏–π –ï–∫—Å–ø—Ä–µ—Å",
            "–ë—Ä–∞–º—ñ–Ω–∏ —Ç–∞ –ë—Ä–∞—Ç—Ç—è", "–ß–µ—Ä–≤–æ–Ω–∏–π –ü—ñ—â–∞–Ω–∏–π –í–∏—Ö–æ—Ä", "–ú–µ—Ç–∞–ª —ñ –ü–æ–ø—ñ–ª", "–®–≤–∏–¥–∫–∏–π –ê—Ç–æ–º", "–ß–æ—Ä–Ω–∞ –î–æ—Ä–æ–≥–∞",
            "–í–∞–Ω—Ç–∞–∂–Ω—ñ –ü—Ä–∏–≤–∏–¥–∏", "–¢–æ–∫—Å–∏—á–Ω–∏–π –¢—Ä–∞–Ω–∑–∏—Ç", "–°—Ç–∞–ª–µ–≤—ñ –ö–æ—á—ñ–≤–Ω–∏–∫–∏", "–†–∞–¥—ñ–∞—Ü—ñ–π–Ω—ñ –†–µ–π–¥–µ—Ä–∏"
        ];

        let currentCaravan = {};

        function rollDice(sides) {
            return Math.floor(Math.random() * sides) + 1;
        }

        function getRandomImprovements() {
            const shuffled = [...improvements].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 2);
        }

        function calculateStats(improvements) {
            let maxHP = 25;
            let armor = 1;
            let movement = 10;

            improvements.forEach(imp => {
                if (imp.name === "–ü–æ—Å–∏–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è") maxHP += 10;
                if (imp.name === "–î–æ–¥–∞—Ç–∫–æ–≤–∞ –±—Ä–æ–Ω—è") armor += 2;
                if (imp.name === "–î–æ–¥–∞—Ç–∫–æ–≤–µ –º—ñ—Å—Ü–µ –¥–ª—è –∫–æ—Ä–º—É (–ø–∞–ª–∏–≤–∞)") movement += 5;
            });

            return { maxHP, armor, movement };
        }

        function generateCaravan() {
            const selectedImprovements = getRandomImprovements();
            const stats = calculateStats(selectedImprovements);
            const budget = rollDice(6) + 4;
            
            const randomMeeting = meetingOptions[Math.floor(Math.random() * meetingOptions.length)];
            const randomLastJob = lastJobOptions[Math.floor(Math.random() * lastJobOptions.length)];
            const randomWentWrong = wentWrongOptions[Math.floor(Math.random() * wentWrongOptions.length)];
            
            const karmaRoll = rollDice(6);
            let karmaValue, karmaAspect;
            if (karmaRoll === 1) {
                karmaValue = -5;
                karmaAspect = "—Ç–µ–º–Ω—ñ –æ—Å–æ–±–∏";
            } else if (karmaRoll >= 2 && karmaRoll <= 4) {
                karmaValue = 0;
                karmaAspect = "–ø—Ä–æ—Å—Ç—ñ –≤–æ–ª–æ—Ü—é–≥–∏";
            } else {
                karmaValue = +5;
                karmaAspect = "–≥—ñ–¥–Ω—ñ –ª—é–¥–∏";
            }

            currentCaravan = {
                improvements: selectedImprovements,
                stats: stats,
                budget: budget,
                story: { 
                    meeting: randomMeeting,
                    lastJob: randomLastJob,
                    wentWrong: randomWentWrong,
                    companyName: companyNames[Math.floor(Math.random() * companyNames.length)]
                },
                karma: { value: karmaValue, aspect: karmaAspect }
            };

            displayCaravan();
        }

        function displayCaravan() {
            document.getElementById('caravan-content').style.display = 'block';
            
            document.getElementById('max-hp').textContent = currentCaravan.stats.maxHP;
            document.getElementById('armor').textContent = currentCaravan.stats.armor;
            document.getElementById('movement').textContent = currentCaravan.stats.movement;
            document.getElementById('budget').textContent = currentCaravan.budget;
            
            document.getElementById('company-name-display').textContent = currentCaravan.story.companyName;
            
            const improvementsList = document.getElementById('improvements-list');
            improvementsList.innerHTML = '';
            currentCaravan.improvements.forEach(imp => {
                const div = document.createElement('div');
                div.className = 'improvement-item';
                div.innerHTML = `
                    <div class="improvement-name">${imp.name}</div>
                    <div class="improvement-desc">${imp.desc}</div>
                `;
                improvementsList.appendChild(div);
            });
            
            document.getElementById('meeting-answer').textContent = currentCaravan.story.meeting;
            document.getElementById('last-job-answer').textContent = currentCaravan.story.lastJob;
            document.getElementById('went-wrong-answer').textContent = currentCaravan.story.wentWrong;
            
            document.getElementById('karma-value').textContent = currentCaravan.karma.value >= 0 ? `+${currentCaravan.karma.value}` : currentCaravan.karma.value;
            document.getElementById('karma-aspect').textContent = currentCaravan.karma.aspect;
        }

        function rerollCompanyName() {
            const randomName = companyNames[Math.floor(Math.random() * companyNames.length)];
            currentCaravan.story.companyName = randomName;
            document.getElementById('company-name-display').textContent = currentCaravan.story.companyName;
        }

        function rerollImprovements() {
            const newImprovements = getRandomImprovements();
            const newStats = calculateStats(newImprovements);
            
            currentCaravan.improvements = newImprovements;
            currentCaravan.stats = newStats;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
            document.getElementById('max-hp').textContent = currentCaravan.stats.maxHP;
            document.getElementById('armor').textContent = currentCaravan.stats.armor;
            document.getElementById('movement').textContent = currentCaravan.stats.movement;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—Ä–∞—â–µ–Ω—å
            const improvementsList = document.getElementById('improvements-list');
            improvementsList.innerHTML = '';
            currentCaravan.improvements.forEach(imp => {
                const div = document.createElement('div');
                div.className = 'improvement-item';
                div.innerHTML = `
                    <div class="improvement-name">${imp.name}</div>
                    <div class="improvement-desc">${imp.desc}</div>
                `;
                improvementsList.appendChild(div);
            });
        }

        function rerollKarma() {
            const karmaRoll = rollDice(6);
            let karmaValue, karmaAspect;
            if (karmaRoll === 1) {
                karmaValue = -5;
                karmaAspect = "—Ç–µ–º–Ω—ñ –æ—Å–æ–±–∏";
            } else if (karmaRoll >= 2 && karmaRoll <= 4) {
                karmaValue = 0;
                karmaAspect = "–ø—Ä–æ—Å—Ç—ñ –≤–æ–ª–æ—Ü—é–≥–∏";
            } else {
                karmaValue = +5;
                karmaAspect = "–≥—ñ–¥–Ω—ñ –ª—é–¥–∏";
            }
            
            currentCaravan.karma = { value: karmaValue, aspect: karmaAspect };
            
            document.getElementById('karma-value').textContent = currentCaravan.karma.value >= 0 ? `+${currentCaravan.karma.value}` : currentCaravan.karma.value;
            document.getElementById('karma-aspect').textContent = currentCaravan.karma.aspect;
        }

        function rerollMeeting() {
            const randomMeeting = meetingOptions[Math.floor(Math.random() * meetingOptions.length)];
            currentCaravan.story.meeting = randomMeeting;
            document.getElementById('meeting-answer').textContent = currentCaravan.story.meeting;
        }

        function rerollLastJob() {
            const randomLastJob = lastJobOptions[Math.floor(Math.random() * lastJobOptions.length)];
            currentCaravan.story.lastJob = randomLastJob;
            document.getElementById('last-job-answer').textContent = currentCaravan.story.lastJob;
        }

        function rerollWentWrong() {
            const randomWentWrong = wentWrongOptions[Math.floor(Math.random() * wentWrongOptions.length)];
            currentCaravan.story.wentWrong = randomWentWrong;
            document.getElementById('went-wrong-answer').textContent = currentCaravan.story.wentWrong;
        }
    </script>

    <script>
    // --- Text export logic (added) ---
    function caravanToPlainText(c) {
        if (!c || !c.stats) return "";
        const lines = [];
        const val = (n) => (n != null ? n : "‚Äî");
        const sign = (n) => (n >= 0 ? ("+" + n) : ("" + n));
        try {
            lines.push("–ö–æ–º–ø–∞–Ω—ñ—è: " + (c.story?.companyName || "‚Äî"));
            lines.push("–ú–∞–∫—Å. –û–ó: " + val(c.stats.maxHP));
            lines.push("–ë—Ä–æ–Ω—è: " + val(c.stats.armor));
            lines.push("–ó–∞–ø–∞—Å —Ö–æ–¥—É: " + val(c.stats.movement));
            lines.push("–ë—é–¥–∂–µ—Ç –∫—Ä–∏—à–æ–∫: " + val(c.budget));
            lines.push("–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è:");
            (c.improvements || []).forEach((imp, i) => {
                lines.push("  - " + (imp.name || "‚Äî") + (imp.desc ? (": " + imp.desc) : ""));
            });
            lines.push("–Ü—Å—Ç–æ—Ä—ñ—è:");
            lines.push("  –Ø–∫ –ø–æ–∑–Ω–∞–π–æ–º–∏–ª–∏—Å—å ‚Äî " + (c.story?.meeting || "‚Äî"));
            lines.push("  –û—Å—Ç–∞–Ω–Ω—è —Å–ø—Ä–∞–≤–∞ ‚Äî " + (c.story?.lastJob || "‚Äî"));
            lines.push("  –©–æ –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫ ‚Äî " + (c.story?.wentWrong || "‚Äî"));
            lines.push("–ö–∞—Ä–º–∞: " + (c.karma ? sign(c.karma.value || 0) + " ‚Äî " + (c.karma.aspect || "‚Äî") : "‚Äî"));
            lines.push("–†–µ–ø—É—Ç–∞—Ü—ñ—è: –Ω—ñ—Ö—Ç–æ –π –∑–≤–∞—Ç–∏ –Ω—ñ—è–∫");
        } catch(e) {}
        return lines.join("\n");
    }

    function updateTextOutput() {
        var ta = document.getElementById("textOutput");
        if (!ta) return;
        if (typeof currentCaravan !== "undefined" && currentCaravan && currentCaravan.stats) {
            ta.value = caravanToPlainText(currentCaravan);
        } else {
            ta.value = "";
        }
    }

    function setupCopyButton() {
        var btn = document.getElementById("copyBtn");
        if (!btn) return;
        btn.addEventListener("click", async function() {
            var ta = document.getElementById("textOutput");
            if (!ta) return;
            try {
                await navigator.clipboard.writeText(ta.value || "");
                btn.textContent = "‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ";
                setTimeout(function(){ btn.textContent = "üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏"; }, 1500);
            } catch (err) {
                ta.focus();
                ta.select();
                document.execCommand("copy");
                btn.textContent = "‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ";
                setTimeout(function(){ btn.textContent = "üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏"; }, 1500);
            }
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        setupCopyButton();
        // Observe Caravan content changes to refresh text output automatically
        var root = document.getElementById("caravan-content") || document.querySelector(".container") || document.body;
        if (root && "MutationObserver" in window) {
            var obs = new MutationObserver(function() {
                updateTextOutput();
            });
            obs.observe(root, { childList: true, subtree: true, characterData: true });
        }
        updateTextOutput();
    });
    </script>

</body>
</html>
